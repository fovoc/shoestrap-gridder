<?php

// Prioritize loading of REDUX core module
require_once get_template_directory() . '/lib/modules/core.redux/module.php';

if ( !function_exists( 'shoestrap_include_gridder_module' ) ) :
/*
 * Use 'RecursiveDirectoryIterator' if PHP Version >= 5.2.11
 */
function shoestrap_include_gridder_module() {
  // Include module from the Gridder Addon
  $modules_path = new RecursiveDirectoryIterator( dirname( __FILE__ ) );
  $recIterator  = new RecursiveIteratorIterator( $modules_path );
  $regex        = new RegexIterator( $recIterator, '/\/module.php$/i' );

  foreach( $regex as $item ) {
    require_once $item->getPathname();
  }
}
endif;


if ( !function_exists( 'shoestrap_include_gridder_module_fallback' ) ) :
/*
 * Fallback to 'glob' if PHP Version < 5.2.11
 */
function shoestrap_include_gridder_module_fallback() {
  // Include module from the Gridder Addon
  foreach( glob( dirname( __FILE__ ) . '/module.php' ) as $module ) {
    require_once $module;
  }
}
endif;


// PHP version control
$phpversion = phpversion();
if ( version_compare( $phpversion, '5.2.11', '<' ) ) :
  shoestrap_include_gridder_module();
else :
  shoestrap_include_gridder_module_fallback();
endif;
